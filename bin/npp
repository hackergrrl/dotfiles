#!/bin/bash

if [ $# -eq 0 ]; then
  echo 'USAGE: npp patch|minor|major'
  exit 1
fi

dependency-check . && npm test
if [ $? -ne 0 ]; then
  exit $?
fi

npm publish --color=always --dry-run | head -n -1
read -p 'publish (y/N) ' answer
if [[ -n $answer && $answer == "y" ]]; then
  npm version $1 && npm publish -q && git p --follow-tags
else
  echo 'aborting publish'
fi
